<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <style>
        body { font-family: Arial; padding: 40px; background: #f5f5f5; }
        .box { max-width: 550px; margin:auto; background:#fff; padding:25px; border-radius:10px; }
        input, button { width:100%; padding:12px; margin-top:10px; }
        button { background:black; color:white; cursor:pointer; }
        #linksList a { display:block; margin-top:8px; background:#eee; padding:10px; border-radius:6px; }
    </style>
</head>
<body>

<div class="box">
    <h2>Your Dashboard</h2>

    <h3>Add New Link</h3>
    <input type="text" id="linkTitle" placeholder="Enter Title">
    <input type="url" id="linkURL" placeholder="Enter URL">
    <button id="saveLinkBtn">Add</button>

    <h3>Your Links</h3>
    <div id="linksList"></div>

    <br>
    <button id="viewProfileBtn">View Public Profile</button>
    <button id="logoutBtn">Logout</button>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyBH6hhP7-JUZJdTirFGA-6W9_unIC1k6Lo",
  authDomain: "newpro-fa54b.firebaseapp.com",
  projectId: "newpro-fa54b",
  storageBucket: "newpro-fa54b.firebasestorage.app",
  messagingSenderId: "541759932178",
  appId: "1:541759932178:web:4b3feedfbb5a10b33e55cb"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let username = null;

onAuthStateChanged(auth, async (user) => {
    if (!user) window.location.href = "index.html";

    username = localStorage.getItem("username");
    loadLinks();
});

async function loadLinks() {
    const ref = doc(db, "users", username);
    const snap = await getDoc(ref);

    let html = "";
    snap.data().links.forEach(l => {
        html += `<a href="${l.url}" target="_blank">${l.title}</a>`;
    });

    linksList.innerHTML = html;
}

saveLinkBtn.onclick = async () => {
    const title = linkTitle.value.trim();
    const url = linkURL.value.trim();

    if (!title || !url) return alert("Enter both fields");

    const ref = doc(db, "users", username);
    const snap = await getDoc(ref);
    let links = snap.data().links;

    links.push({ title, url });
    await setDoc(ref, { links }, { merge: true });

    linkTitle.value = "";
    linkURL.value = "";
    loadLinks();
};

viewProfileBtn.onclick = () => {
   window.location.href = `/${username}`;

};

logoutBtn.onclick = () => {
    auth.signOut();
    localStorage.removeItem("username");
    window.location.href = "index.html";
};
</script>

</body>
</html>

